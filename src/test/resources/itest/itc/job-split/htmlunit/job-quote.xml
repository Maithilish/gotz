<?xml version="1.0" encoding="UTF-8"?>

<gotz xmlns="http://codetab.org/gotz" xmlns:xf="http://codetab.org/xfields"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://codetab.org/gotz gotz.xsd">

    <locators group="quote">
        <locator name="ITC"
            url="src/test/resources/itest/itc/page/itc-quote-prefix.html" />
    </locators>

    <fields name="locator" class="org.codetab.gotz.model.Locator"
        xmlns="http://codetab.org/xfields">

        <steps name="stepsSeq">
            <step name="seeder"
                class="org.codetab.gotz.step.extract.LocatorSeeder">
                <nextStep>loader</nextStep>
                <unique>true</unique>
            </step>
            <step name="loader" class="org.codetab.gotz.step.extract.URLLoader">
                <nextStep>parser</nextStep>
                <unique>true</unique>
            </step>
            <step name="parser" class="org.codetab.gotz.step.extract.HtmlParser">
                <nextStep>process</nextStep>
            </step>
            <step name="process" class="org.codetab.gotz.step.convert.DataFilter">
                <nextStep>converter</nextStep>
            </step>
            <step name="converter"
                class="org.codetab.gotz.step.convert.DataConverter">
                <nextStep>appender</nextStep>
            </step>
            <step name="appender" class="org.codetab.gotz.step.load.DataAppender">
                <nextStep>end</nextStep>
                <appender name="list"
                    class="org.codetab.gotz.step.load.appender.ListAppender">
                    <encoder name="csv"
                        class="org.codetab.gotz.step.load.encoder.CsvEncoder">
                    </encoder>
                </appender>
            </step>
        </steps>

        <tasks name="quote" group="quote">
            <task name="finlocators" dataDef="finlocators">
                <steps ref="stepsSeq">
                    <step name="process"
                        class="org.codetab.gotz.step.convert.LocatorCreator">
                        <nextStep>seeder</nextStep>
                    </step>
                </steps>
            </task>
            <task name="quotePage" dataDef="quotePage">
                <steps ref="stepsSeq" />
            </task>
            <task name="price" dataDef="price">
                <steps ref="stepsSeq" />
            </task>
            <live>P0D</live>
        </tasks>

    </fields>

    <dataDef name="finlocators">
        <xf:fields>
            <xf:member name="bs">
                <xf:group>bs</xf:group>
            </xf:member>
            <xf:member name="pl">
                <xf:group>pl</xf:group>
            </xf:member>
        </xf:fields>

        <axis name="col">
            <xf:fields>
                <xf:script script="configs.getRunDateTime()" />
            </xf:fields>
            <member name="date" />
        </axis>
        <axis name="row">
            <xf:fields>
                <xf:query region="//*[@id='page_links']/table"
                    field="//li/a[contains(.,'%{row.match}')]" />
            </xf:fields>
            <member name="bs" match="Balance Sheet" />
            <member name="pl" match="Profit &amp; Loss" />
        </axis>
        <axis name="fact">
            <xf:fields>
                <xf:query region="//*[@id='page_links']/table"
                    field="*//a[contains(.,'%{row.match}')]/@href" />
                <!-- uses local file (quote page) -->
                <xf:prefix>src/test/resources/itest/itc/page/</xf:prefix>
            </xf:fields>
        </axis>
    </dataDef>

    <dataDef name="quotePage">
        <axis name="col">
            <xf:fields>
                <xf:script script="document.getFromDate()" />
            </xf:fields>
            <member name="date" />
        </axis>
        <axis name="row">
            <xf:fields>
                <xf:query region="//*[@id='snapshot']"
                    field="div/div/div[starts-with(child::text(),'%{row.match}')]/child::text()" />
            </xf:fields>
            <member name="MC" match="MARKET CAP" />
            <member name="EPS" match="EPS (TTM)" />
            <member name="PE" match="P/E" />
            <member name="PC" match="P/C" />
            <member name="BV" match="BOOK VALUE" />
            <member name="PB" match="PRICE/BOOK" />
            <member name="DIV" match="DIV (%)" />
            <member name="DY" match="DIV YIELD" />
            <member name="FV" match="FACE VALUE" />
            <member name="IND PE" match="INDUSTRY P/E" />
        </axis>
        <axis name="fact">
            <xf:fields>
                <xf:query region="//*[@id='snapshot']"
                    field="div/div/div[starts-with(child::text(),'%{row.match}')]/following-sibling::div[1]" />
            </xf:fields>
        </axis>
    </dataDef>
    <dataDef name="price">
        <axis name="col">
            <xf:fields>
                <xf:script script="document.getFromDate()" />
            </xf:fields>
            <member name="date" />
        </axis>
        <axis name="row">
            <member name="Price" value="Price" />
        </axis>
        <axis name="fact">
            <xf:fields>
                <xf:query region="//*[@id='price_tick_span']"
                    field="strong" />
            </xf:fields>
        </axis>
    </dataDef>

</gotz>


